<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
  <meta name="description" content="Maestro - World's Most Advanced Professional Metronome & Tuner" />
  <meta name="theme-color" content="#8b8bff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Maestro" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="msapplication-TileColor" content="#8b8bff" />
  <meta name="msapplication-config" content="./browserconfig.xml" />
  
  <title>Maestro ‚Äî World-Class Metronome & Tuner</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json" />
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="./icon-192x192.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="./icon-96x96.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="./icon-96x96.png" />
  <link rel="mask-icon" href="./icon-192x192.png" color="#8b8bff" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />

  <style>
    :root {
      --glass-bg: rgba(255, 255, 255, 0.12);
      --glass-border: rgba(255, 255, 255, 0.25);
      --accent: #8b8bff;
      --accent-strong: #6f6fff;
      --accent-light: #a8a8ff;
      --text: #f5f6ff;
      --muted: rgba(255, 255, 255, 0.65);
      --shadow: rgba(0, 0, 0, 0.35);
      --pulse-color: #8b8bff;
      --success: #4ade80;
      --warning: #fbbf24;
      --error: #f87171;
    }

    * {
      box-sizing: border-box;
      font-family: 'Inter', system-ui, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #0b0f2b, #1a1f4d, #0f1333, #1a1f4d);
      background-size: 400% 400%;
      animation: bgMove 25s ease infinite;
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
    }

    @keyframes bgMove {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .app {
      width: 100%;
      max-width: 1400px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 24px;
      background: linear-gradient(135deg, rgba(255 255 255 / 0.1), rgba(255 255 255 / 0.02));
      padding: 36px 44px;
      border-radius: 32px;
      backdrop-filter: blur(28px) saturate(180%);
      -webkit-backdrop-filter: blur(28px) saturate(180%);
      border: 1px solid var(--glass-border);
      box-shadow: 0 50px 100px var(--shadow), 0 0 0 1px rgba(139, 139, 255, 0.1);
      position: relative;
    }

    .app::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 30% 20%, rgba(139, 139, 255, 0.1), transparent 50%);
      pointer-events: none;
      border-radius: 32px;
    }

    header {
      grid-column: 1 / -1;
      text-align: center;
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }

    header h1 {
      font-weight: 800;
      font-size: 4.2rem;
      letter-spacing: -0.08em;
      margin: 0;
      background: linear-gradient(135deg, var(--accent), var(--accent-light), var(--accent));
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradientShift 3s ease infinite;
      text-shadow: 0 0 30px rgba(139, 139, 255, 0.5);
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    header small {
      display: block;
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--muted);
      margin-top: 8px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .card {
      background: var(--glass-bg);
      border-radius: 24px;
      border: 1px solid var(--glass-border);
      box-shadow: 0 20px 60px var(--shadow);
      padding: 28px 32px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 30px 80px var(--shadow);
      border-color: rgba(139, 139, 255, 0.4);
    }

    .card h2 {
      font-size: 1.9rem;
      font-weight: 700;
      margin: 0 0 8px 0;
      color: var(--accent-strong);
      text-shadow: 0 0 12px var(--accent-strong);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card p {
      color: var(--muted);
      font-size: 0.95rem;
      margin: 0 0 12px 0;
      line-height: 1.5;
    }

    .bpm-display {
      font-weight: 800;
      font-size: 6rem;
      text-align: center;
      color: var(--accent);
      text-shadow: 0 0 30px var(--accent);
      user-select: none;
      position: relative;
      margin: 12px 0;
      letter-spacing: -0.05em;
    }

    .bpm-display.pulse {
      animation: pulse 300ms ease forwards;
    }

    @keyframes pulse {
      0% {
        text-shadow: 0 0 50px var(--pulse-color);
        transform: scale(1.15);
      }
      100% {
        text-shadow: 0 0 30px var(--pulse-color);
        transform: scale(1);
      }
    }

    .bpm-input-group {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 20px;
    }

    input[type='range'] {
      -webkit-appearance: none;
      appearance: none;
      flex: 1;
      height: 10px;
      border-radius: 10px;
      background: rgba(255 255 255 / 0.15);
      outline: none;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    input[type='range']::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      -moz-appearance: none;
      width: 26px;
      height: 26px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 15px var(--accent), 0 4px 8px rgba(0, 0, 0, 0.3);
      transition: all 0.25s ease;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    input[type='range']::-moz-range-thumb {
      width: 26px;
      height: 26px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 15px var(--accent), 0 4px 8px rgba(0, 0, 0, 0.3);
      transition: all 0.25s ease;
    }

    input[type='range']:hover::-webkit-slider-thumb,
    input[type='range']:hover::-moz-range-thumb {
      box-shadow: 0 0 25px var(--accent-strong), 0 6px 12px rgba(0, 0, 0, 0.4);
      transform: scale(1.1);
    }

    input[type='number'] {
      background: rgba(255, 255, 255, 0.15);
      border: 1.5px solid var(--glass-border);
      border-radius: 12px;
      color: var(--text);
      font-weight: 700;
      font-size: 1.2rem;
      padding: 8px 14px;
      width: 90px;
      text-align: center;
      transition: all 0.3s ease;
    }

    input[type='number']:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 15px rgba(139, 139, 255, 0.4);
      background: rgba(255, 255, 255, 0.2);
    }

    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    button {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      border: none;
      border-radius: 16px;
      padding: 14px 26px;
      font-weight: 700;
      font-size: 1rem;
      color: #0b0f2b;
      cursor: pointer;
      box-shadow: 0 12px 28px rgba(139, 139, 255, 0.5);
      transition: all 0.3s ease;
      user-select: none;
      flex: 1 1 auto;
      text-align: center;
      min-width: 100px;
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    button:active::before {
      width: 300px;
      height: 300px;
    }

    button.secondary {
      background: rgba(255, 255, 255, 0.18);
      color: var(--text);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      flex: 1 1 auto;
      min-width: 90px;
      font-weight: 600;
    }

    button:hover {
      box-shadow: 0 18px 40px rgba(139, 139, 255, 0.7);
      transform: translateY(-3px);
    }

    button.secondary:hover {
      background: rgba(255, 255, 255, 0.28);
    }

    button.active {
      background: linear-gradient(135deg, var(--success), #22c55e);
      box-shadow: 0 0 25px rgba(74, 222, 128, 0.6);
    }

    select {
      background: rgba(255, 255, 255, 0.15);
      border: 1.5px solid var(--glass-border);
      border-radius: 12px;
      color: var(--text);
      font-weight: 600;
      padding: 10px 16px;
      min-width: 100px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }

    select:hover {
      background-color: rgba(255, 255, 255, 0.25);
      border-color: var(--accent);
    }

    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 15px rgba(139, 139, 255, 0.3);
    }

    label {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .led {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.25);
      box-shadow: inset 0 0 0 2px rgba(0, 0, 0, 0.3);
      transition: all 0.2s ease;
      user-select: none;
      flex-shrink: 0;
    }

    .led.active {
      background: var(--accent);
      box-shadow: 0 0 30px var(--accent), 0 0 60px var(--accent);
      animation: ledPulse 0.3s ease;
    }

    @keyframes ledPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    .visual-metronome {
      width: 100%;
      height: 120px;
      position: relative;
      margin: 20px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .pendulum {
      width: 4px;
      height: 100px;
      background: linear-gradient(180deg, var(--accent), var(--accent-strong));
      border-radius: 2px;
      position: absolute;
      transform-origin: top center;
      box-shadow: 0 0 20px var(--accent);
      transition: transform 0.1s linear;
    }

    .pendulum.active {
      animation: swing 1s ease-in-out infinite;
    }

    @keyframes swing {
      0%, 100% { transform: rotate(-30deg); }
      50% { transform: rotate(30deg); }
    }

    .beat-indicator {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin: 16px 0;
      flex-wrap: wrap;
    }

    .beat-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid var(--glass-border);
      transition: all 0.2s ease;
    }

    .beat-dot.active {
      background: var(--accent);
      border-color: var(--accent);
      box-shadow: 0 0 15px var(--accent);
      transform: scale(1.4);
    }

    .beat-dot.accent {
      background: var(--accent-strong);
      border-color: var(--accent-strong);
    }

    .song {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.95rem;
      margin-bottom: 10px;
      user-select: none;
      padding: 10px;
      border-radius: 10px;
      transition: background 0.2s ease;
    }

    .song:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .song button {
      min-width: 70px;
      padding: 8px 16px;
      font-size: 0.9rem;
    }

    .note {
      font-weight: 800;
      font-size: 4rem;
      color: var(--accent);
      text-align: center;
      user-select: none;
      margin: 10px 0;
      text-shadow: 0 0 20px var(--accent);
      letter-spacing: 0.05em;
    }

    .cents {
      font-size: 1.2rem;
      text-align: center;
      color: var(--muted);
      user-select: none;
      margin-top: 8px;
      font-weight: 600;
    }

    .tuner-needle {
      width: 100%;
      height: 120px;
      position: relative;
      margin: 20px 0;
      background: linear-gradient(90deg, 
        var(--error) 0%, 
        var(--warning) 25%, 
        var(--success) 45%, 
        var(--success) 55%, 
        var(--warning) 75%, 
        var(--error) 100%);
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }

    .tuner-needle::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--text);
      transform: translateX(-50%);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
    }

    .needle {
      position: absolute;
      top: 10px;
      width: 4px;
      height: 100px;
      background: var(--text);
      transform-origin: bottom center;
      transition: transform 0.1s ease-out;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
      border-radius: 2px;
    }

    .frequency-display {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
      margin-top: 10px;
    }

    .sound-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      margin: 16px 0;
    }

    .sound-btn {
      padding: 10px;
      font-size: 0.85rem;
      min-width: auto;
    }

    .volume-control {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 12px 0;
    }

    .volume-control input[type='range'] {
      flex: 1;
    }

    .volume-value {
      min-width: 50px;
      text-align: center;
      font-weight: 600;
      color: var(--muted);
    }

    .preset-section {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 8px;
    }

    .preset-section::-webkit-scrollbar {
      width: 6px;
    }

    .preset-section::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    .preset-section::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 3px;
    }

    .tempo-ramp {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 12px 0;
    }

    .tempo-ramp input[type='checkbox'] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    footer {
      grid-column: 1 / -1;
      margin-top: 28px;
      text-align: center;
      color: var(--muted);
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 0.05em;
      user-select: none;
      padding-top: 20px;
      border-top: 1px solid var(--glass-border);
    }

    .keyboard-hint {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.4);
      margin-top: 8px;
      font-style: italic;
    }

    @media (max-width: 900px) {
      .app {
        grid-template-columns: 1fr !important;
        padding: 24px;
      }

      header h1 {
        font-size: 3rem;
      }

      .bpm-display {
        font-size: 4.5rem;
      }

      .note {
        font-size: 3rem;
      }
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    /* PWA Install Button */
    .install-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      border: none;
      border-radius: 50px;
      padding: 12px 24px;
      color: #0b0f2b;
      font-weight: 700;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(139, 139, 255, 0.5);
      transition: all 0.3s ease;
      display: none;
      align-items: center;
      gap: 8px;
    }

    .install-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(139, 139, 255, 0.7);
    }

    .install-btn.show {
      display: flex;
    }

    /* Floating Window Mode */
    .floating-mode {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90vw;
      max-width: 500px;
      max-height: 90vh;
      z-index: 10000;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      resize: both;
      overflow: auto;
    }

    .floating-controls {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 10001;
      display: flex;
      gap: 8px;
    }

    .floating-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: all 0.2s ease;
    }

    .floating-btn:hover {
      background: rgba(0, 0, 0, 0.8);
      transform: scale(1.1);
    }

    /* Video Platform Integration */
    .video-integration {
      position: fixed;
      bottom: 80px;
      right: 20px;
      z-index: 999;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 16px;
      backdrop-filter: blur(10px);
      display: none;
      flex-direction: column;
      gap: 12px;
      min-width: 200px;
    }

    .video-integration.show {
      display: flex;
    }

    .video-integration h3 {
      margin: 0 0 8px 0;
      font-size: 1rem;
      color: var(--accent);
    }

    .api-key-input {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 8px 12px;
      color: var(--text);
      font-size: 0.85rem;
      width: 100%;
    }

    .api-key-input:focus {
      outline: none;
      border-color: var(--accent);
    }
  </style>
</head>
<body>
  <div class="app" role="main" aria-label="Maestro Professional Metronome and Tuner">
    <header>
      <h1>Maestro</h1>
      <small>World-Class Metronome & Tuner</small>
    </header>

    <!-- Metronome Section -->
    <section class="card" aria-labelledby="metronome-title" role="region">
      <h2 id="metronome-title">üéµ Pro Metronome</h2>
      <p>Professional-grade timing with advanced features</p>
      
      <div id="bpmDisplay" class="bpm-display" aria-live="polite">120</div>
      
      <div class="bpm-input-group">
        <input type="range" id="bpmRange" min="20" max="300" value="120" step="1" aria-label="BPM" />
        <input type="number" id="bpmInput" min="20" max="300" value="120" aria-label="BPM value" />
      </div>

      <div class="visual-metronome">
        <div id="pendulum" class="pendulum"></div>
      </div>

      <div id="beatIndicator" class="beat-indicator" aria-label="Beat indicators"></div>

      <div class="controls">
        <button id="startBtn" aria-pressed="false" aria-label="Start metronome">‚ñ∂ Start</button>
        <button id="stopBtn" class="secondary" aria-pressed="false" aria-label="Stop metronome">‚èπ Stop</button>
        <button id="tapBtn" class="secondary" aria-label="Tap tempo">üëÜ Tap</button>
        <div id="led" class="led" aria-hidden="true"></div>
      </div>

      <div class="sound-selector">
        <button class="sound-btn secondary" data-sound="click">Click</button>
        <button class="sound-btn secondary" data-sound="beep">Beep</button>
        <button class="sound-btn secondary" data-sound="wood">Wood</button>
        <button class="sound-btn secondary active" data-sound="tick">Tick</button>
      </div>

      <div class="volume-control">
        <label>Volume</label>
        <input type="range" id="volume" min="0" max="100" value="70" aria-label="Volume" />
        <span class="volume-value" id="volumeValue">70%</span>
      </div>

      <p class="keyboard-hint">Press Spacebar to start/stop, Arrow keys to adjust BPM</p>
    </section>

    <!-- Rhythm Controls -->
    <section class="card" aria-labelledby="rhythm-title" role="region">
      <h2 id="rhythm-title">üéº Rhythm Controls</h2>
      <p>Advanced timing and feel customization</p>
      
      <div class="controls" style="flex-direction: column; align-items: stretch; gap: 16px;">
        <div style="display: flex; align-items: center; gap: 12px;">
          <label for="timeSig" style="min-width: 80px;">Time Sig</label>
          <select id="timeSig">
            <option value="2">2/4</option>
            <option value="3">3/4</option>
            <option value="4" selected>4/4</option>
            <option value="5">5/4</option>
            <option value="6">6/8</option>
            <option value="7">7/8</option>
            <option value="9">9/8</option>
            <option value="12">12/8</option>
          </select>
        </div>

        <div style="display: flex; align-items: center; gap: 12px;">
          <label for="subdivision" style="min-width: 80px;">Subdivision</label>
          <select id="subdivision">
            <option value="1">Quarter (1/4)</option>
            <option value="2">Eighth (1/8)</option>
            <option value="4">Sixteenth (1/16)</option>
            <option value="3">Triplet (1/3)</option>
            <option value="6">Sextuplet (1/6)</option>
          </select>
        </div>

        <div style="display: flex; align-items: center; gap: 12px;">
          <label for="swing" style="min-width: 80px;">Swing</label>
          <input type="range" id="swing" min="0" max="75" value="0" style="flex: 1;" />
          <span style="min-width: 50px; text-align: center; font-weight: 600;">0%</span>
        </div>

        <div class="tempo-ramp">
          <input type="checkbox" id="tempoRamp" />
          <label for="tempoRamp">Tempo Ramp (Acceleration)</label>
        </div>
      </div>
    </section>

    <!-- Presets -->
    <section class="card" aria-labelledby="preset-title" role="region">
      <h2 id="preset-title">üé∂ Song Presets</h2>
      <p>Quick tempo setup for popular songs</p>
      <div class="preset-section" id="presetList">
        <!-- Presets will be populated by JS -->
      </div>
    </section>

    <!-- Advanced Tuner -->
    <section class="card" aria-labelledby="tuner-title" role="region">
      <h2 id="tuner-title">üé∏ Professional Tuner</h2>
      <p>Studio-grade pitch detection with multiple tuning standards</p>
      
      <div id="note" class="note" aria-live="polite">‚Äì</div>
      <div id="cents" class="cents" aria-live="polite">Waiting for input‚Ä¶</div>
      <div id="frequency" class="frequency-display">0 Hz</div>

      <div class="tuner-needle">
        <div id="needle" class="needle"></div>
      </div>

      <div class="controls" style="flex-direction: column; gap: 12px;">
        <div style="display: flex; align-items: center; gap: 12px;">
          <label for="tuningStandard" style="min-width: 100px;">Tuning</label>
          <select id="tuningStandard">
            <option value="440">A440 (Standard)</option>
            <option value="432">A432 (Verdi)</option>
            <option value="415">A415 (Baroque)</option>
            <option value="446">A446 (Higher)</option>
          </select>
        </div>

        <div style="display: flex; align-items: center; gap: 12px;">
          <label for="instrument" style="min-width: 100px;">Instrument</label>
          <select id="instrument">
            <option value="chromatic">Chromatic</option>
            <option value="guitar">Guitar (EADGBE)</option>
            <option value="bass">Bass (EADG)</option>
            <option value="violin">Violin (GDAE)</option>
            <option value="ukulele">Ukulele (GCEA)</option>
            <option value="mandolin">Mandolin (GDAE)</option>
          </select>
        </div>

        <button id="tunerBtn" aria-pressed="false" aria-label="Start tuner">üé§ Start Tuner</button>
      </div>
    </section>

    <footer>
      Maestro ‚Äî World-Class Metronome & Tuner<br>
      Designed & Developed by Eldosha
    </footer>
  </div>

  <!-- PWA Install Button -->
  <button id="installBtn" class="install-btn" aria-label="Install Maestro App">
    üì± Install App
  </button>

  <!-- Floating Window Controls -->
  <div class="floating-controls" id="floatingControls" style="display: none;">
    <button class="floating-btn" id="minimizeBtn" aria-label="Minimize">‚ûñ</button>
    <button class="floating-btn" id="closeFloatBtn" aria-label="Close">‚úï</button>
  </div>

  <!-- Video Platform Integration Panel -->
  <div class="video-integration" id="videoIntegration">
    <h3>üé¨ Video Platform Integration</h3>
    <div>
      <label style="font-size: 0.85rem; display: block; margin-bottom: 4px;">YouTube API Key:</label>
      <input type="text" class="api-key-input" id="youtubeApiKey" placeholder="Enter YouTube API Key" />
    </div>
    <div>
      <label style="font-size: 0.85rem; display: block; margin-bottom: 4px;">Vimeo API Key:</label>
      <input type="text" class="api-key-input" id="vimeoApiKey" placeholder="Enter Vimeo API Key" />
    </div>
    <div>
      <label style="font-size: 0.85rem; display: block; margin-bottom: 4px;">Custom Domain:</label>
      <input type="text" class="api-key-input" id="customDomain" placeholder="yourdomain.com" />
    </div>
    <button class="secondary" style="margin-top: 8px;" onclick="saveApiKeys()">Save Keys</button>
    <button class="secondary" onclick="toggleFloatingMode()">ü™ü Enable Floating Mode</button>
  </div>

  <script>
    // Global state
    let audioCtx, analyser, microphone, dataArray, timer, beat = 0, lastTap = 0;
    let isRunning = false;
    let currentSound = 'tick';
    let volume = 0.7;
    let tuningStandard = 440;
    let isTunerActive = false;
    let animationFrame = null;

    // DOM elements
    const bpmEl = document.getElementById('bpmDisplay');
    const bpmRange = document.getElementById('bpmRange');
    const bpmInput = document.getElementById('bpmInput');
    const led = document.getElementById('led');
    const pendulum = document.getElementById('pendulum');
    const beatIndicator = document.getElementById('beatIndicator');
    const volumeSlider = document.getElementById('volume');
    const volumeValue = document.getElementById('volumeValue');
    const swingSlider = document.getElementById('swing');
    const swingValue = swingSlider.nextElementSibling;

    // Initialize AudioContext
    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    // Sound generation functions
    const soundGenerators = {
      click: (accent) => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.value = accent ? 1200 : 800;
        gain.gain.setValueAtTime(0, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(volume * (accent ? 0.15 : 0.1), audioCtx.currentTime + 0.001);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
        osc.connect(gain).connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
      },
      beep: (accent) => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.value = accent ? 880 : 660;
        gain.gain.setValueAtTime(0, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(volume * (accent ? 0.12 : 0.08), audioCtx.currentTime + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.15);
        osc.connect(gain).connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.15);
      },
      wood: (accent) => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        const filter = audioCtx.createBiquadFilter();
        osc.type = 'sawtooth';
        osc.frequency.value = accent ? 200 : 150;
        filter.type = 'lowpass';
        filter.frequency.value = 800;
        gain.gain.setValueAtTime(0, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(volume * (accent ? 0.1 : 0.07), audioCtx.currentTime + 0.001);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
        osc.connect(filter).connect(gain).connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.2);
      },
      tick: (accent) => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = accent ? 'sine' : 'square';
        osc.frequency.value = accent ? 1400 : 900;
        gain.gain.setValueAtTime(0, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(volume * (accent ? 0.12 : 0.08), audioCtx.currentTime + 0.001);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
        osc.connect(gain).connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.05);
      }
    };

    function playSound(accent = false) {
      initAudio();
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
      soundGenerators[currentSound](accent);
    }

    // Metronome functions
    function startMetronome() {
      stopMetronome();
      isRunning = true;
      initAudio();
      
      const bpm = +bpmRange.value;
      const beats = +document.getElementById('timeSig').value;
      const subdiv = +document.getElementById('subdivision').value;
      const swing = +swingSlider.value / 100;
      const base = (60000 / bpm) / subdiv;
      beat = 0;

      // Update beat indicators
      updateBeatIndicators(beats * subdiv);

      // Start pendulum animation
      pendulum.classList.add('active');
      const pendulumSpeed = 60000 / bpm;
      pendulum.style.animationDuration = `${pendulumSpeed}ms`;

      let startTime = performance.now();
      let expectedTime = startTime;

      function scheduleTick() {
        if (!isRunning) return;

        const now = performance.now();
        const drift = now - expectedTime;
        expectedTime += base;

        const beatInMeasure = beat % (beats * subdiv);
        const isAccent = beatInMeasure === 0;
        const isSubdivision = beatInMeasure % subdiv === 0;

        if (isSubdivision) {
          playSound(isAccent);
          led.classList.add('active');
          bpmEl.classList.add('pulse');
          
          // Update beat indicator
          const dots = beatIndicator.querySelectorAll('.beat-dot');
          dots.forEach((dot, i) => {
            dot.classList.remove('active');
            if (i === Math.floor(beatInMeasure / subdiv)) {
              dot.classList.add('active');
            }
          });

          setTimeout(() => {
            led.classList.remove('active');
            bpmEl.classList.remove('pulse');
          }, 100);
        }

        beat++;
        let delay = base;
        if (swing && beat % 2 === 1) {
          delay += base * swing;
        }

        // Compensate for drift
        const nextDelay = Math.max(0, delay - drift);
        timer = setTimeout(scheduleTick, nextDelay);
      }

      scheduleTick();
    }

    function stopMetronome() {
      isRunning = false;
      clearTimeout(timer);
      pendulum.classList.remove('active');
      led.classList.remove('active');
      bpmEl.classList.remove('pulse');
      beatIndicator.querySelectorAll('.beat-dot').forEach(dot => dot.classList.remove('active'));
    }

    function updateBeatIndicators(totalBeats) {
      beatIndicator.innerHTML = '';
      const beats = +document.getElementById('timeSig').value;
      const subdiv = +document.getElementById('subdivision').value;
      const beatsPerMeasure = Math.ceil(totalBeats / beats);

      for (let i = 0; i < beatsPerMeasure; i++) {
        const dot = document.createElement('div');
        dot.className = 'beat-dot' + (i === 0 ? ' accent' : '');
        beatIndicator.appendChild(dot);
      }
    }

    // BPM controls
    function syncBPM() {
      const value = bpmRange.value;
      bpmEl.textContent = value;
      bpmInput.value = value;
    }

    bpmRange.addEventListener('input', syncBPM);
    bpmInput.addEventListener('input', (e) => {
      let val = Math.max(20, Math.min(300, parseInt(e.target.value) || 120));
      bpmRange.value = val;
      bpmEl.textContent = val;
      e.target.value = val;
    });

    // Swing slider
    swingSlider.addEventListener('input', (e) => {
      swingValue.textContent = e.target.value + '%';
    });

    // Volume control
    volumeSlider.addEventListener('input', (e) => {
      volume = e.target.value / 100;
      volumeValue.textContent = e.target.value + '%';
    });

    // Sound selector
    document.querySelectorAll('.sound-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.sound-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentSound = btn.dataset.sound;
      });
    });

    // Button handlers
    document.getElementById('startBtn').addEventListener('click', () => {
      startMetronome();
      document.getElementById('startBtn').classList.add('active');
      document.getElementById('stopBtn').classList.remove('active');
    });

    document.getElementById('stopBtn').addEventListener('click', () => {
      stopMetronome();
      document.getElementById('startBtn').classList.remove('active');
      document.getElementById('stopBtn').classList.add('active');
    });

    // Tap tempo
    document.getElementById('tapBtn').addEventListener('click', () => {
      const now = Date.now();
      if (lastTap && now - lastTap < 3000) {
        const bpm = Math.round(60000 / (now - lastTap));
        const clampedBpm = Math.max(20, Math.min(300, bpm));
        bpmRange.value = clampedBpm;
        syncBPM();
      }
      lastTap = now;
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
      
      if (e.code === 'Space') {
        e.preventDefault();
        if (isRunning) {
          document.getElementById('stopBtn').click();
        } else {
          document.getElementById('startBtn').click();
        }
      } else if (e.code === 'ArrowUp') {
        e.preventDefault();
        bpmRange.value = Math.min(300, +bpmRange.value + 1);
        syncBPM();
      } else if (e.code === 'ArrowDown') {
        e.preventDefault();
        bpmRange.value = Math.max(20, +bpmRange.value - 1);
        syncBPM();
      } else if (e.code === 'ArrowLeft') {
        e.preventDefault();
        bpmRange.value = Math.max(20, +bpmRange.value - 5);
        syncBPM();
      } else if (e.code === 'ArrowRight') {
        e.preventDefault();
        bpmRange.value = Math.min(300, +bpmRange.value + 5);
        syncBPM();
      }
    });

    // Presets
    const presets = [
      { name: 'Love Story', artist: 'Taylor Swift', bpm: 120 },
      { name: 'Billie Jean', artist: 'Michael Jackson', bpm: 117 },
      { name: 'Shape of You', artist: 'Ed Sheeran', bpm: 96 },
      { name: 'Someone Like You', artist: 'Adele', bpm: 67 },
      { name: 'Blinding Lights', artist: 'The Weeknd', bpm: 171 },
      { name: 'Bohemian Rhapsody', artist: 'Queen', bpm: 72 },
      { name: 'Stairway to Heaven', artist: 'Led Zeppelin', bpm: 63 },
      { name: 'Sweet Child O\' Mine', artist: 'Guns N\' Roses', bpm: 125 },
      { name: 'Hotel California', artist: 'Eagles', bpm: 75 },
      { name: 'Wonderwall', artist: 'Oasis', bpm: 87 },
      { name: 'Smells Like Teen Spirit', artist: 'Nirvana', bpm: 117 },
      { name: 'Back in Black', artist: 'AC/DC', bpm: 93 },
      { name: 'Thunderstruck', artist: 'AC/DC', bpm: 135 },
      { name: 'Enter Sandman', artist: 'Metallica', bpm: 123 },
      { name: 'November Rain', artist: 'Guns N\' Roses', bpm: 82 }
    ];

    const presetList = document.getElementById('presetList');
    presets.forEach(preset => {
      const div = document.createElement('div');
      div.className = 'song';
      div.innerHTML = `
        <span>${preset.name} ‚Äì ${preset.artist}</span>
        <button onclick="setBPM(${preset.bpm})" aria-label="Set tempo to ${preset.bpm}">${preset.bpm}</button>
      `;
      presetList.appendChild(div);
    });

    function setBPM(val) {
      bpmRange.value = val;
      syncBPM();
      if (isRunning) {
        startMetronome();
      }
    }

    // Tuner functions
    const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const instrumentTunings = {
      chromatic: null,
      guitar: ['E2', 'A2', 'D3', 'G3', 'B3', 'E4'],
      bass: ['E1', 'A1', 'D2', 'G2'],
      violin: ['G3', 'D4', 'A4', 'E5'],
      ukulele: ['G4', 'C4', 'E4', 'A4'],
      mandolin: ['G3', 'D4', 'A4', 'E5']
    };

    function frequencyToNote(freq) {
      if (freq < 20 || freq > 20000) return null;
      const A4 = tuningStandard;
      const semitones = 12 * Math.log2(freq / A4);
      const noteIndex = Math.round(semitones) % 12;
      const octave = Math.floor(semitones / 12) + 4;
      const note = noteNames[(noteIndex + 9) % 12];
      const cents = (semitones - Math.round(semitones)) * 100;
      return { note: note + octave, cents, frequency: freq };
    }

    function getPitch() {
      if (!analyser || !isTunerActive) return null;

      dataArray = new Uint8Array(analyser.frequencyBinCount);
      analyser.getByteFrequencyData(dataArray);

      let maxIndex = 0;
      let maxValue = 0;
      for (let i = 0; i < dataArray.length; i++) {
        if (dataArray[i] > maxValue) {
          maxValue = dataArray[i];
          maxIndex = i;
        }
      }

      if (maxValue < 10) return null;

      const nyquist = audioCtx.sampleRate / 2;
      const frequency = (maxIndex / dataArray.length) * nyquist;
      return frequency;
    }

    function updateTuner() {
      if (!isTunerActive) return;

      const freq = getPitch();
      const noteEl = document.getElementById('note');
      const centsEl = document.getElementById('cents');
      const freqEl = document.getElementById('frequency');
      const needle = document.getElementById('needle');

      if (!freq || freq < 50 || freq > 2000) {
        noteEl.textContent = '‚Äì';
        centsEl.textContent = 'Waiting for input‚Ä¶';
        freqEl.textContent = '0 Hz';
        needle.style.transform = 'rotate(0deg)';
        return;
      }

      const result = frequencyToNote(freq);
      if (!result) return;

      noteEl.textContent = result.note;
      freqEl.textContent = result.frequency.toFixed(1) + ' Hz';

      const cents = Math.max(-50, Math.min(50, result.cents));
      const rotation = (cents / 50) * 45;
      needle.style.transform = `rotate(${rotation}deg)`;

      if (Math.abs(cents) < 5) {
        centsEl.textContent = '‚úì In Tune';
        centsEl.style.color = 'var(--success)';
      } else if (Math.abs(cents) < 20) {
        centsEl.textContent = `${cents > 0 ? '+' : ''}${cents.toFixed(1)} cents`;
        centsEl.style.color = 'var(--warning)';
      } else {
        centsEl.textContent = `${cents > 0 ? '+' : ''}${cents.toFixed(1)} cents`;
        centsEl.style.color = 'var(--error)';
      }

      animationFrame = requestAnimationFrame(updateTuner);
    }

    document.getElementById('tunerBtn').addEventListener('click', async () => {
      if (isTunerActive) {
        // Stop tuner
        isTunerActive = false;
        if (animationFrame) cancelAnimationFrame(animationFrame);
        if (microphone) {
          microphone.getTracks().forEach(track => track.stop());
          microphone = null;
        }
        document.getElementById('tunerBtn').textContent = 'üé§ Start Tuner';
        document.getElementById('tunerBtn').classList.remove('active');
      } else {
        // Start tuner
        try {
          initAudio();
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          microphone = stream;
          analyser = audioCtx.createAnalyser();
          analyser.fftSize = 8192;
          const source = audioCtx.createMediaStreamSource(stream);
          source.connect(analyser);
          isTunerActive = true;
          document.getElementById('tunerBtn').textContent = '‚èπ Stop Tuner';
          document.getElementById('tunerBtn').classList.add('active');
          updateTuner();
        } catch (err) {
          alert('Microphone access denied. Please enable microphone permissions.');
          console.error('Microphone error:', err);
        }
      }
    });

    document.getElementById('tuningStandard').addEventListener('change', (e) => {
      tuningStandard = parseFloat(e.target.value);
    });

    // Initialize
    syncBPM();
    updateBeatIndicators(16);

    // ========== PWA Functionality ==========
    let deferredPrompt;
    let isInstalled = false;

    // Check if app is already installed
    if (window.matchMedia('(display-mode: standalone)').matches || 
        window.navigator.standalone === true ||
        document.referrer.includes('android-app://')) {
      isInstalled = true;
      document.getElementById('installBtn').style.display = 'none';
    }

    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then((registration) => {
            console.log('Service Worker registered:', registration.scope);
            
            // Check for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New service worker available
                  if (confirm('New version available! Reload to update?')) {
                    window.location.reload();
                  }
                }
              });
            });
          })
          .catch((error) => {
            console.error('Service Worker registration failed:', error);
          });
      });

      // Listen for service worker updates
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        window.location.reload();
      });
    }

    // PWA Install Prompt
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      const installBtn = document.getElementById('installBtn');
      installBtn.classList.add('show');
      
      installBtn.addEventListener('click', async () => {
        if (!deferredPrompt) return;
        
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log('User choice:', outcome);
        
        deferredPrompt = null;
        installBtn.classList.remove('show');
      });
    });

    window.addEventListener('appinstalled', () => {
      console.log('PWA installed');
      isInstalled = true;
      document.getElementById('installBtn').classList.remove('show');
      deferredPrompt = null;
    });

    // ========== Floating Window / Picture-in-Picture ==========
    let floatingWindow = null;
    let isFloating = false;

    function toggleFloatingMode() {
      if (isFloating) {
        exitFloatingMode();
      } else {
        enterFloatingMode();
      }
    }

    function enterFloatingMode() {
      // Try Picture-in-Picture API first (for video elements)
      if (document.pictureInPictureEnabled && !document.pictureInPictureElement) {
        // Create a video element for PiP
        const video = document.createElement('video');
        video.srcObject = new MediaStream();
        video.style.display = 'none';
        document.body.appendChild(video);
        
        video.requestPictureInPicture().then(() => {
          console.log('Entered Picture-in-Picture mode');
          isFloating = true;
        }).catch(err => {
          console.log('PiP not supported, using custom floating window');
          createCustomFloatingWindow();
        });
      } else {
        createCustomFloatingWindow();
      }
    }

    function createCustomFloatingWindow() {
      const app = document.querySelector('.app');
      app.classList.add('floating-mode');
      document.getElementById('floatingControls').style.display = 'flex';
      isFloating = true;
      
      // Make draggable
      makeDraggable(app);
    }

    function exitFloatingMode() {
      if (document.pictureInPictureElement) {
        document.exitPictureInPicture();
      }
      
      const app = document.querySelector('.app');
      app.classList.remove('floating-mode');
      document.getElementById('floatingControls').style.display = 'none';
      isFloating = false;
    }

    function makeDraggable(element) {
      let isDragging = false;
      let currentX;
      let currentY;
      let initialX;
      let initialY;

      element.addEventListener('mousedown', (e) => {
        if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
        
        initialX = e.clientX - element.offsetLeft;
        initialY = e.clientY - element.offsetTop;

        if (e.target === element || element.contains(e.target)) {
          isDragging = true;
        }
      });

      document.addEventListener('mousemove', (e) => {
        if (isDragging) {
          e.preventDefault();
          currentX = e.clientX - initialX;
          currentY = e.clientY - initialY;

          element.style.left = currentX + 'px';
          element.style.top = currentY + 'px';
          element.style.transform = 'none';
        }
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
      });
    }

    document.getElementById('minimizeBtn').addEventListener('click', () => {
      const app = document.querySelector('.app');
      app.style.display = app.style.display === 'none' ? 'flex' : 'none';
    });

    document.getElementById('closeFloatBtn').addEventListener('click', exitFloatingMode);

    // ========== Video Platform Integration APIs ==========
    const API_KEYS_STORAGE = 'maestro_api_keys';

    function saveApiKeys() {
      const keys = {
        youtube: document.getElementById('youtubeApiKey').value,
        vimeo: document.getElementById('vimeoApiKey').value,
        customDomain: document.getElementById('customDomain').value
      };
      localStorage.setItem(API_KEYS_STORAGE, JSON.stringify(keys));
      alert('API keys saved!');
    }

    function loadApiKeys() {
      const stored = localStorage.getItem(API_KEYS_STORAGE);
      if (stored) {
        const keys = JSON.parse(stored);
        document.getElementById('youtubeApiKey').value = keys.youtube || '';
        document.getElementById('vimeoApiKey').value = keys.vimeo || '';
        document.getElementById('customDomain').value = keys.customDomain || '';
      }
    }

    // YouTube API Integration
    function initYouTubeIntegration() {
      const keys = JSON.parse(localStorage.getItem(API_KEYS_STORAGE) || '{}');
      if (!keys.youtube) return;

      // YouTube IFrame API
      const tag = document.createElement('script');
      tag.src = 'https://www.youtube.com/iframe_api';
      const firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      window.onYouTubeIframeAPIReady = function() {
        console.log('YouTube API ready');
        // YouTube API is now available
      };
    }

    // Vimeo API Integration
    function initVimeoIntegration() {
      const keys = JSON.parse(localStorage.getItem(API_KEYS_STORAGE) || '{}');
      if (!keys.vimeo) return;

      // Vimeo Player API
      const tag = document.createElement('script');
      tag.src = 'https://player.vimeo.com/api/player.js';
      document.head.appendChild(tag);
    }

    // Custom Domain Integration (for embedding)
    function generateEmbedCode() {
      const domain = document.getElementById('customDomain').value;
      if (!domain) return null;

      return {
        iframe: '<iframe src="https://' + domain + '/maestro.html" width="400" height="600" frameborder="0" allow="microphone"></iframe>',
        script: '<script src="https://' + domain + '/maestro-embed.js"><\/script>',
        api: 'https://' + domain + '/api/maestro'
      };
    }

    // Expose API for external sites
    window.MaestroAPI = {
      version: '1.0.0',
      startMetronome: (bpm = 120) => {
        bpmRange.value = bpm;
        syncBPM();
        startMetronome();
      },
      stopMetronome: stopMetronome,
      setBPM: setBPM,
      getBPM: () => +bpmRange.value,
      isRunning: () => isRunning,
      openTuner: () => {
        document.getElementById('tunerBtn').click();
      },
      enterFloatingMode: enterFloatingMode,
      exitFloatingMode: exitFloatingMode,
      getEmbedCode: generateEmbedCode
    };

    // Load saved API keys on page load
    loadApiKeys();
    initYouTubeIntegration();
    initVimeoIntegration();

    // Handle URL parameters for shortcuts
    const urlParams = new URLSearchParams(window.location.search);
    const action = urlParams.get('action');
    const bpm = urlParams.get('bpm');

    if (action === 'start' && bpm) {
      setBPM(parseInt(bpm));
      setTimeout(() => startMetronome(), 500);
    } else if (action === 'tuner') {
      setTimeout(() => document.getElementById('tunerBtn').click(), 500);
    }

    // Show video integration panel toggle
    let integrationVisible = false;
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.shiftKey && e.key === 'I') {
        e.preventDefault();
        integrationVisible = !integrationVisible;
        document.getElementById('videoIntegration').classList.toggle('show', integrationVisible);
      }
    });

    // Add floating window button to header
    const floatBtn = document.createElement('button');
    floatBtn.className = 'secondary';
    floatBtn.textContent = 'ü™ü Float';
    floatBtn.style.marginLeft = 'auto';
    floatBtn.onclick = toggleFloatingMode;
    document.querySelector('header').appendChild(floatBtn);
  </script>
</body>
</html>
